<!DOCTYPE html>
<html lang="ru" x-data="contactManager()" x-init="initLucide()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Contact List Manager</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Alpine.js -->
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <!-- Lucide Icons -->
  <script defer src="https://unpkg.com/lucide@0.276.0/dist/umd/lucide.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen flex">
  <!-- SIDEBAR -->
  <aside class="w-64 bg-white border-r border-gray-200 p-6 hidden md:block">
    <h2 class="text-xl font-semibold text-gray-800 mb-6">Меню</h2>
    <nav class="space-y-2">
      <a href="#" @click.prevent="view='lists'" 
         class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors"
         :class="view==='lists' ? 'bg-gray-100 font-medium' : ''">
        <i data-lucide="list" class="w-5 h-5 mr-3"></i>
        <span>Списки</span>
      </a>
      <a href="#" @click.prevent="view='contacts'" 
         class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors"
         :class="view==='contacts' ? 'bg-gray-100 font-medium' : ''">
        <i data-lucide="users" class="w-5 h-5 mr-3"></i>
        <span>Контакты</span>
      </a>
      <a href="#" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors">
        <i data-lucide="settings" class="w-5 h-5 mr-3"></i>
        <span>Настройки</span>
      </a>
      <a href="#" class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors">
        <i data-lucide="info" class="w-5 h-5 mr-3"></i>
        <span>О программе</span>
      </a>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="flex-1 p-6 overflow-auto">
    <div class="max-w-7xl mx-auto">
      <!-- HEADER for Lists -->
      <template x-if="view==='lists'">
        <div>
          <div class="flex items-center justify-between mb-8">
            <div>
              <h1 class="text-3xl font-bold text-gray-900">Contact Lists</h1>
              <p class="text-gray-600 mt-1">Manage your email marketing lists</p>
            </div>
            <button @click="showCreateModal = true"
                    class="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
              <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
              Create New List
            </button>
          </div>
          <!-- TOOLBAR -->
          <div class="flex items-center space-x-4 mb-6">
            <div class="flex-1 relative">
              <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"></i>
              <input type="text" placeholder="Search lists..." x-model="search"
                     class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/>
            </div>
            <div class="relative">
              <i data-lucide="filter" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"></i>
              <select x-model="filterBy"
                      class="pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white">
                <option value="all">All Lists</option>
                <option value="large">Large (500+)</option>
                <option value="small">Small (&lt;500)</option>
                <option value="recent">Recently Updated</option>
              </select>
            </div>
          </div>
          <!-- LISTS GRID -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <template x-for="list in filteredLists()" :key="list.id">
              <div class="bg-white rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between mb-4">
                  <div class="flex-1">
                    <h3 class="text-lg font-semibold text-gray-900 mb-1" x-text="list.name"></h3>
                    <div class="flex items-center text-sm text-gray-600 space-x-4">
                      <span class="flex items-center">
                        <i data-lucide="users" class="w-4 h-4 mr-1"></i>
                        <span x-text="list.totalContacts"></span> contacts
                      </span>
                      <span class="flex items-center">
                        <i data-lucide="calendar" class="w-4 h-4 mr-1"></i>
                        <span x-text="list.lastUpdated"></span>
                      </span>
                    </div>
                  </div>
                  <button @click="showDeleteConfirm = list.id" class="text-gray-400 hover:text-gray-600 p-1">
                    <i data-lucide="more-horizontal" class="w-4 h-4"></i>
                  </button>
                </div>
                <!-- VALIDATION BAR -->
                <div class="mb-4">
                  <div class="flex text-xs text-gray-600 mb-1 justify-between">
                    <span>Valid: <span x-text="list.validContacts"></span></span>
                    <span>Invalid: <span x-text="list.invalidContacts"></span></span>
                    <span>Blacklisted: <span x-text="list.blacklistedContacts"></span></span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden flex">
                    <div class="bg-green-500" :style="`width: ${list.validContacts/list.totalContacts*100}%`"></div>
                    <div class="bg-red-500"   :style="`width: ${list.invalidContacts/list.totalContacts*100}%`"></div>
                    <div class="bg-gray-400"  :style="`width: ${list.blacklistedContacts/list.totalContacts*100}%`"></div>
                  </div>
                </div>
                <!-- ACTIONS -->
                <div class="flex items-center space-x-2">
                  <button @click="viewList(list)" class="flex items-center px-3 py-1.5 text-blue-600 hover:bg-blue-50 rounded-md text-sm">
                    <i data-lucide="eye" class="w-4 h-4 mr-1"></i> View
                  </button>
                  <button class="flex items-center px-3 py-1.5 text-gray-600 hover:bg-gray-50 rounded-md text-sm">
                    <i data-lucide="pen-line" class="w-4 h-4 mr-1"></i> Rename
                  </button>
                  <button class="flex items-center px-3 py-1.5 text-gray-600 hover:bg-gray-50 rounded-md text-sm">
                    <i data-lucide="download" class="w-4 h-4 mr-1"></i> Export
                  </button>
                  <button @click="showDeleteConfirm = list.id" class="flex items-center px-3 py-1.5 text-red-600 hover:bg-red-50 rounded-md text-sm">
                    <i data-lucide="trash-2" class="w-4 h-4 mr-1"></i> Delete
                  </button>
                </div>
              </div>
            </template>
          </div>
          <template x-if="filteredLists().length===0">
            <div class="text-center py-12">
              <i data-lucide="users" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
              <h3 class="text-lg font-medium text-gray-900 mb-2">No lists found</h3>
              <p class="text-gray-600">Create your first email list to get started.</p>
            </div>
          </template>
        </div>
      </template>

      <!-- CONTACTS VIEW -->
      <template x-if="view==='contacts'">
        <div>
          <button @click="backToLists()"
                  class="flex items-center text-blue-600 hover:text-blue-700 mb-4">
            <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i> Back to Lists
          </button>
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-2xl font-bold text-gray-900" x-text="selectedList.name"></h1>
              <div class="flex items-center space-x-4 mt-2 text-sm text-gray-600">
                <span class="flex items-center">
                  <i data-lucide="users" class="w-4 h-4 mr-1"></i>
                  <span x-text="selectedList.totalContacts"></span> contacts
                </span>
                <span class="flex items-center">
                  <i data-lucide="calendar" class="w-4 h-4 mr-1"></i>
                  Updated <span x-text="selectedList.lastUpdated"></span>
                </span>
              </div>
            </div>
            <div class="flex space-x-3">
              <button @click="showImportModal=true"
                      class="flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                <i data-lucide="upload" class="w-4 h-4 mr-2"></i> Import
              </button>
              <button class="flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                <i data-lucide="download" class="w-4 h-4 mr-2"></i> Export
              </button>
              <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                Validate List
              </button>
            </div>
          </div>
          <!-- SUMMARY -->
          <div class="grid grid-cols-3 gap-4 mb-6">
            <template x-for="stat in ['valid','invalid','blacklisted']" :key="stat">
              <div class="bg-white rounded-lg p-4 border border-gray-200 flex items-center">
                <i :data-lucide="stat==='valid'? 'check-circle': stat==='invalid'? 'x-circle':'alert-circle'"
                   class="w-5 h-5 mr-2"
                   :class="stat==='valid'? 'text-green-500': stat==='invalid'? 'text-red-500':'text-gray-500'"></i>
                <div>
                  <p class="text-sm text-gray-600" x-text="stat==='valid'? 'Valid Contacts': stat==='invalid'? 'Invalid Contacts':'Blacklisted'"></p>
                  <p class="text-xl font-semibold text-gray-900" x-text="selectedList[stat+'Contacts']"></p>
                </div>
              </div>
            </template>
          </div>
          <!-- CONTACTS TABLE -->
          <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
            <table class="w-full">
              <thead class="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th class="w-12 px-4 py-3">
                    <input type="checkbox" @click="toggleSelectAll()" :checked="allSelected()" class="rounded border-gray-300"/>
                  </th>
                  <th class="text-left px-4 py-3 text-sm font-medium text-gray-700">Email</th>
                  <th class="text-left px-4 py-3 text-sm font-medium text-gray-700">Status</th>
                  <th class="text-left px-4 py-3 text-sm font-medium text-gray-700">Added Date</th>
                  <th class="w-12 px-4 py-3"></th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                <template x-for="contact in paginatedContacts()" :key="contact.id">
                  <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3">
                      <input type="checkbox" :value="contact.id" @click="selectContact(contact.id)"
                             :checked="selectedContacts.includes(contact.id)" class="rounded border-gray-300"/>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-900" x-text="contact.email"></td>
                    <td class="px-4 py-3">
                      <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                            :class="statusColor(contact.status)">
                        <i :data-lucide="statusIcon(contact.status)" class="w-4 h-4"></i>
                        <span class="ml-1" x-text="contact.status"></span>
                      </span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-600" x-text="contact.addedDate"></td>
                    <td class="px-4 py-3">
                      <button class="text-gray-400 hover:text-gray-600">
                        <i data-lucide="more-horizontal" class="w-4 h-4"></i>
                      </button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
          <!-- PAGINATION -->
          <div class="flex items-center justify-between mt-6">
            <p class="text-sm text-gray-600">
              Showing <span x-text="startIndex()+1"></span> to <span x-text="Math.min(endIndex(), contacts.length)"></span> of <span x-text="contacts.length"></span> contacts
            </p>
            <div class="flex space-x-2">
              <button @click="prevPage()" :disabled="page===1"
                      class="px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
                Previous
              </button>
              <template x-for="p in totalPages()" :key="p">
                <button @click="page = p"
                        class="px-3 py-1 border rounded text-sm"
                        :class="page===p? 'bg-blue-600 text-white border-blue-600':'border-gray-300 hover:bg-gray-50'">
                  <span x-text="p"></span>
                </button>
              </template>
              <button @click="nextPage()" :disabled="page===totalPages()"
                      class="px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
                Next
              </button>
            </div>
          </div>
        </div>
      </template>
    </div>

    <!-- CREATE LIST MODAL -->
    <div x-show="showCreateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 w-full max-w-md">
        <h3 class="text-lg font-semibold mb-4">Create New List</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">List Name</label>
            <input type="text" x-model="newListName" placeholder="Enter list name..."
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" autofocus/>
          </div>
          <div class="flex space-x-3">
            <button @click="cancelCreate()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancel</button>
            <button @click="createList()" :disabled="!newListName.trim()"
                    class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">Create List</button>
          </div>
        </div>
      </div>
    </div>

    <!-- DELETE CONFIRM MODAL -->
    <div x-show="showDeleteConfirm" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 w-full max-w-md">
        <h3 class="text-lg font-semibold mb-4">Delete List</h3>
        <p class="text-gray-600 mb-6">Are you sure you want to delete this list? This action cannot be undone.</p>
        <div class="flex space-x-3">
          <button @click="showDeleteConfirm = null" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancel</button>
          <button @click="deleteList()" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Delete</button>
        </div>
      </div>
    </div>

    <!-- IMPORT MODAL -->
    <div x-show="showImportModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 w-full max-w-md">
        <h3 class="text-lg font-semibold mb-4">Import Contacts</h3>
        <div class="space-y-4">
          <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
            <i data-lucide="upload" class="w-8 h-8 text-gray-400 mx-auto mb-2"></i>
            <p class="text-sm text-gray-600 mb-2">Drag & drop your file here, or</p>
            <button @click="$refs.fileInput.click()" class="text-blue-600 hover:text-blue-700 text-sm font-medium">browse files</button>
            <input x-ref="fileInput" type="file" accept=".csv,.txt" class="hidden"/>
            <p class="text-xs text-gray-500 mt-2">Supports .csv and .txt files</p>
          </div>
          <div class="flex space-x-3">
            <button @click="showImportModal=false" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancel</button>
            <button class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Import</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Alpine.js Component Script -->
  <script>
    function contactManager() {
      return {
        view: 'lists',
        search: '',
        filterBy: 'all',
        showCreateModal: false,
        showDeleteConfirm: null,
        showImportModal: false,
        newListName: '',
        page: 1,
        emailLists: [
          { id:1, name:'Newsletter Subscribers', totalContacts:1247, lastUpdated:'2024-05-20', validContacts:1190, invalidContacts:35, blacklistedContacts:22 },
          { id:2, name:'Premium Users', totalContacts:532, lastUpdated:'2024-05-18', validContacts:525, invalidContacts:4, blacklistedContacts:3 },
          { id:3, name:'Trial Users', totalContacts:843, lastUpdated:'2024-05-15', validContacts:801, invalidContacts:28, blacklistedContacts:14 },
          { id:4, name:'Event Attendees', totalContacts:298, lastUpdated:'2024-05-12', validContacts:287, invalidContacts:7, blacklistedContacts:4 },
        ],
        contacts: [
          { id:1,email:'john.doe@example.com',status:'Valid',addedDate:'2024-05-15' },
          { id:2,email:'jane.smith@company.co',status:'Valid',addedDate:'2024-05-14' },
          { id:3,email:'invalid@badomain',status:'Invalid',addedDate:'2024-05-13' },
          { id:4,email:'spam@blacklist.com',status:'Blacklisted',addedDate:'2024-05-12' },
          { id:5,email:'user@domain.com',status:'Valid',addedDate:'2024-05-11' },
          { id:6,email:'test@email.org',status:'Valid',addedDate:'2024-05-10' },
          { id:7,email:'bad@email',status:'Invalid',addedDate:'2024-05-09' },
          { id:8,email:'good@example.net',status:'Valid',addedDate:'2024-05-08' },
        ],
        selectedList: null,
        selectedContacts: [],

        initLucide() {
          lucide.createIcons();
        },

        filteredLists() {
          return this.emailLists.filter(l => {
            const matchSearch = l.name.toLowerCase().includes(this.search.toLowerCase());
            const matchFilter = this.filterBy==='all'
              || (this.filterBy==='large' && l.totalContacts>500)
              || (this.filterBy==='small' && l.totalContacts<=500)
              || (this.filterBy==='recent' && new Date(l.lastUpdated) > new Date('2024-05-15'));
            return matchSearch && matchFilter;
          });
        },

        viewList(list) {
          this.selectedList = {...list};
          this.view = 'contacts';
          this.page = 1;
          this.selectedContacts = [];
          setTimeout(() => lucide.createIcons(), 10);
        },

        backToLists() {
          this.view = 'lists';
          setTimeout(() => lucide.createIcons(), 10);
        },

        createList() {
          const id = this.emailLists.length+1;
          this.emailLists.push({
            id, name:this.newListName, totalContacts:0, lastUpdated: new Date().toISOString().split('T')[0],
            validContacts:0, invalidContacts:0, blacklistedContacts:0
          });
          this.newListName = '';
          this.showCreateModal = false;
        },

        cancelCreate() {
          this.newListName = '';
          this.showCreateModal = false;
        },

        deleteList() {
          this.emailLists = this.emailLists.filter(l => l.id!==this.showDeleteConfirm);
          this.showDeleteConfirm = null;
        },

        // Contacts pagination & selection
        contactsPerPage: 10,
        paginatedContacts() {
          const start = (this.page-1)*this.contactsPerPage;
          return this.contacts.slice(start, start+this.contactsPerPage);
        },
        totalPages() {
          return Math.ceil(this.contacts.length/this.contactsPerPage);
        },
        prevPage() { if(this.page>1) this.page--; },
        nextPage(){ if(this.page<this.totalPages()) this.page++; },
        startIndex() { return (this.page-1)*this.contactsPerPage; },
        endIndex() { return this.page*this.contactsPerPage; },

        selectContact(id) {
          const idx = this.selectedContacts.indexOf(id);
          if (idx>=0) this.selectedContacts.splice(idx,1);
          else this.selectedContacts.push(id);
        },
        allSelected() {
          return this.selectedContacts.length === this.contacts.length;
        },
        toggleSelectAll() {
          this.allSelected()
            ? this.selectedContacts = []
            : this.selectedContacts = this.contacts.map(c=>c.id);
        },

        statusColor(status) {
          return status==='Valid'
            ? 'text-green-600 bg-green-50'
            : status==='Invalid'
              ? 'text-red-600 bg-red-50'
              : 'text-gray-600 bg-gray-50';
        },
        statusIcon(status) {
          return status==='Valid'
            ? 'check-circle'
            : status==='Invalid'
              ? 'x-circle'
              : 'alert-circle';
        },
      };
    }
  </script>
</body>
</html>
