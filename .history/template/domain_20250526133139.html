<!DOCTYPE html>
<html lang="en" x-data="emailPlatform()" x-init="init()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EmailPro</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Alpine.js -->
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <!-- Lucide Icons -->
  <script defer src="https://cdn.jsdelivr.net/npm/lucide@0.278.0/dist/umd/lucide.js"></script>
</head>
<body class="bg-gray-50 font-inter">

  <div class="flex h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r border-gray-200 flex flex-col p-6" >
      <h1 class="text-xl font-bold text-gray-900 mb-6">EmailPro</h1>
      <nav class="flex-1">
        <template x-for="item in sidebarItems" :key="item.id">
          <button
            @click="activeSection = item.id"
            :class="{
              'bg-blue-50 text-blue-600 border-r-2 border-blue-600': activeSection === item.id,
              'text-gray-600 hover:bg-gray-50': activeSection !== item.id
            }"
            class="w-full flex items-center px-3 py-2 mb-1 rounded-lg transition-colors"
          >
            <i x-bind:data-lucide="item.icon" class="w-5 h-5 mr-3"></i>
            <span x-text="item.label"></span>
          </button>
        </template>
      </nav>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Header -->
      <header class="bg-white border-b border-gray-200 px-8 py-6">
        <h2 class="text-2xl font-semibold text-gray-900">
          <span x-text="activeSection === 'domains' ? 'Sender Domains' : activeSection === 'senders' ? 'Sender Emails' : 'Dashboard'"></span>
        </h2>
      </header>

      <!-- Content -->
      <main class="flex-1 overflow-auto p-8">
        <!-- Domains Section -->
        <section x-show="activeSection === 'domains'">
          <div class="flex justify-between items-center mb-6">
            <p class="text-gray-600">Manage and verify your sender domains</p>
            <button @click="showAddDomainModal = true"
                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center transition-colors">
              <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Add Domain
            </button>
          </div>

          <div class="grid gap-4">
            <template x-for="domain in domains" :key="domain.id">
              <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                <div class="flex items-center justify-between">
                  <div class="flex-1">
                    <div class="flex items-center mb-2">
                      <h3 class="text-lg font-semibold text-gray-900 mr-3" x-text="domain.name"></h3>
                      <span class="px-2 py-1 rounded-full text-xs font-medium"
                            :class="domain.verified ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'"
                            x-text="domain.verified ? 'Verified' : 'Not Verified'">
                      </span>
                    </div>
                    <div class="flex items-center space-x-6 mb-3">
                      <div class="flex items-center">
                        <span class="text-sm text-gray-600 mr-2">SPF:</span>
                        <i :data-lucide="domain.spf ? 'check' : 'x'" class="w-4 h-4"
                           :class="domain.spf ? 'text-green-500' : 'text-red-500'"></i>
                      </div>
                      <div class="flex items-center">
                        <span class="text-sm text-gray-600 mr-2">DKIM:</span>
                        <i :data-lucide="domain.dkim ? 'check' : 'x'" class="w-4 h-4"
                           :class="domain.dkim ? 'text-green-500' : 'text-red-500'"></i>
                      </div>
                    </div>
                    <p class="text-sm text-gray-500">Added: <span x-text="domain.addedDate"></span></p>
                  </div>
                  <div class="flex items-center space-x-2">
                    <button @click="checkDns(domain.id)"
                            :disabled="isChecking[domain.id]"
                            class="px-3 py-2 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 flex items-center transition-colors disabled:opacity-50">
                      <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"
                         :class="{'animate-spin': isChecking[domain.id]}"></i>
                      Check DNS
                    </button>
                    <button @click="showDnsInstructions = domain.id"
                            class="px-3 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                      Setup
                    </button>
                    <button class="p-2 text-gray-400 hover:text-gray-600">
                      <i data-lucide="more-horizontal" class="w-4 h-4"></i>
                    </button>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </section>

        <!-- Senders Section -->
        <section x-show="activeSection === 'senders'">
          <div class="flex justify-between items-center mb-6">
            <p class="text-gray-600">Manage your sender email addresses</p>
            <button @click="showAddEmailModal = true"
                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center transition-colors">
              <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Add Email Address
            </button>
          </div>

          <div class="grid gap-4">
            <template x-for="email in senderEmails" :key="email.id">
              <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                <div class="flex items-center justify-between">
                  <div class="flex-1">
                    <div class="flex items-center mb-2">
                      <h3 class="text-lg font-semibold text-gray-900 mr-3" x-text="email.email"></h3>
                      <span class="px-2 py-1 rounded-full text-xs font-medium"
                            :class="email.verified ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'"
                            x-text="email.verified ? 'Verified' : 'Pending'">
                      </span>
                    </div>
                    <p class="text-sm text-gray-500">Domain: <span x-text="email.domain"></span></p>
                  </div>
                  <div class="flex items-center space-x-2">
                    <button x-show="!email.verified" @click="resendConfirmation(email)"
                            class="px-3 py-2 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 flex items-center transition-colors">
                      <i data-lucide="send" class="w-4 h-4 mr-2"></i> Resend
                    </button>
                    <button @click="deleteEmail(email.id)" class="p-2 text-red-500 hover:text-red-600">
                      <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </section>

        <!-- Coming Soon -->
        <section x-show="activeSection !== 'domains' && activeSection !== 'senders'" class="text-center py-12">
          <h3 class="text-xl font-semibold text-gray-900 mb-2">Coming Soon</h3>
          <p class="text-gray-600">This section is under development.</p>
        </section>
      </main>
    </div>
  </div>

  <!-- Add Domain Modal -->
  <div x-show="showAddDomainModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-md">
      <h3 class="text-lg font-semibold mb-4">Add New Domain</h3>
      <input type="text" x-model="newDomain" placeholder="example.com"
             class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-blue-500"/>
      <div class="flex space-x-3">
        <button @click="handleAddDomain()"
                class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
          Add Domain
        </button>
        <button @click="showAddDomainModal = false"
                class="flex-1 border border-gray-300 py-2 rounded-lg hover:bg-gray-50 transition-colors">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Add Email Modal -->
  <div x-show="showAddEmailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-md">
      <h3 class="text-lg font-semibold mb-4">Add Sender Email</h3>
      <input type="email" x-model="newEmail" placeholder="hello@example.com"
             class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-blue-500"/>
      <div class="flex space-x-3">
        <button @click="handleAddEmail()"
                class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
          Add Email
        </button>
        <button @click="showAddEmailModal = false"
                class="flex-1 border border-gray-300 py-2 rounded-lg hover:bg-gray-50 transition-colors">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- DNS Instructions Modal -->
  <div x-show="showDnsInstructions" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-auto">
    <div class="bg-white rounded-2xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-semibold">DNS Setup Instructions</h3>
        <button @click="showDnsInstructions = null" class="text-gray-400 hover:text-gray-600">
          <i data-lucide="x" class="w-6 h-6"></i>
        </button>
      </div>
      <div class="space-y-6">
        <!-- SPF -->
        <div class="bg-blue-50 p-4 rounded-lg">
          <div class="flex items-center mb-2">
            <i data-lucide="alert-circle" class="w-5 h-5 text-blue-600 mr-2"></i>
            <h4 class="font-semibold text-blue-800">SPF Record</h4>
          </div>
          <p class="text-sm text-blue-700 mb-3">Add this TXT record to your DNS:</p>
          <div class="bg-white p-3 rounded border flex items-center justify-between">
            <code class="text-sm">v=spf1 include:emailpro.com ~all</code>
            <button @click="copyToClipboard('v=spf1 include:emailpro.com ~all')" class="text-blue-600 hover:text-blue-700">
              <i data-lucide="copy" class="w-4 h-4"></i>
            </button>
          </div>
        </div>
        <!-- DKIM -->
        <div class="bg-green-50 p-4 rounded-lg">
          <div class="flex items-center mb-2">
            <i data-lucide="shield" class="w-5 h-5 text-green-600 mr-2"></i>
            <h4 class="font-semibold text-green-800">DKIM Record</h4>
          </div>
          <p class="text-sm text-green-700 mb-3">Add this TXT record with selector 'ep1':</p>
          <div class="bg-white p-3 rounded border">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-medium">Name:</span>
              <div class="flex items-center">
                <code class="text-sm">ep1._domainkey</code>
                <button @click="copyToClipboard('ep1._domainkey')" class="ml-2 text-green-600 hover:text-green-700">
                  <i data-lucide="copy" class="w-4 h-4"></i>
                </button>
              </div>
            </div>
            <div class="flex items-start justify-between">
              <span class="text-sm font-medium">Value:</span>
              <div class="flex items-start ml-2">
                <code class="text-sm break-all" x-text="currentDkimKey"></code>
                <button @click="copyToClipboard(currentDkimKey)" class="ml-2 text-green-600 hover:text-green-700 flex-shrink-0">
                  <i data-lucide="copy" class="w-4 h-4"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- Notes -->
        <div class="text-sm text-gray-600">
          <p class="mb-2">After adding these DNS records:</p>
          <ul class="list-disc list-inside space-y-1">
            <li>DNS changes may take up to 48 hours to propagate</li>
            <li>Click "Check DNS" to verify your setup</li>
            <li>Both records must be verified before sending emails</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Toast -->
  <div x-show="notification" class="fixed top-4 right-4 bg-white border border-gray-200 rounded-lg shadow-lg p-4 z-50"
       x-transition.opacity.duration.300ms>
    <div class="flex items-center">
      <i :data-lucide="notification.type === 'success' ? 'check-circle' : 'alert-circle'"
         class="w-5 h-5 mr-3"
         :class="notification.type === 'success' ? 'text-green-500' : 'text-red-500'"></i>
      <span class="text-gray-900" x-text="notification.message"></span>
    </div>
  </div>

  <!-- Alpine.js Data & Methods -->
  <script>
    function emailPlatform() {
      return {
        // state
        activeSection: 'domains',
        showAddDomainModal: false,
        showAddEmailModal: false,
        showDnsInstructions: null,
        domains: [
          { id: 1, name: 'mycompany.com', spf: true, dkim: true, verified: true, addedDate: '2024-01-15', token: 'tk_abc123def456' },
          { id: 2, name: 'marketing-site.io', spf: false, dkim: true, verified: false, addedDate: '2024-01-20', token: 'tk_xyz789uvw012' }
        ],
        senderEmails: [
          { id: 1, email: 'support@mycompany.com', domain: 'mycompany.com', verified: true, token: 'em_abc123' },
          { id: 2, email: 'newsletter@marketing-site.io', domain: 'marketing-site.io', verified: false, token: 'em_def456' }
        ],
        newDomain: '',
        newEmail: '',
        notification: null,
        isChecking: {},
        currentDkimKey: '',

        // sidebar items
        sidebarItems: [
          { id: 'dashboard', label: 'Dashboard', icon: 'layout' },
          { id: 'campaigns', label: 'Campaigns', icon: 'bar-chart-3' },
          { id: 'templates', label: 'Templates', icon: 'file-text' },
          { id: 'contacts', label: 'Contact Lists', icon: 'users' },
          { id: 'domains', label: 'Domains', icon: 'globe' },
          { id: 'senders', label: 'Sender Emails', icon: 'mail' },
          { id: 'settings', label: 'Settings', icon: 'settings' }
        ],

        init() {
          // render icons
          lucide.createIcons();
        },

        // utilities
        showNotification(message, type = 'success') {
          this.notification = { message, type };
          setTimeout(() => this.notification = null, 3000);
        },
        copyToClipboard(text) {
          navigator.clipboard.writeText(text);
          this.showNotification('Copied to clipboard!');
        },
        generateToken() {
          return 'tk_' + Math.random().toString(36).substr(2, 12);
        },
        generateDkimKey() {
          // фиксированная заглушка или можно генерировать реальным ключом
          return 'v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC7vbqajDw4o2';
        },

        // actions
        handleAddDomain() {
          if (!this.newDomain) return;
          const id = Date.now();
          const addedDate = new Date().toISOString().split('T')[0];
          const domain = {
            id, name: this.newDomain, spf: false, dkim: false, verified: false,
            addedDate, token: this.generateToken()
          };
          this.domains.push(domain);
          this.newDomain = '';
          this.showAddDomainModal = false;
          this.showDnsInstructions = id;
          this.currentDkimKey = this.generateDkimKey();
          this.showNotification('Domain added successfully! Please configure DNS records.');
          this.$nextTick(() => lucide.createIcons());
        },
        handleAddEmail() {
          if (!this.newEmail) return;
          const id = Date.now();
          const emailObj = {
            id,
            email: this.newEmail,
            domain: this.newEmail.split('@')[1],
            verified: false,
            token: 'em_' + Math.random().toString(36).substr(2, 8)
          };
          this.senderEmails.push(emailObj);
          this.newEmail = '';
          this.showAddEmailModal = false;
          this.showNotification('Verification email sent! Check your inbox.');
          this.$nextTick(() => lucide.createIcons());
        },
        checkDns(domainId) {
          this.isChecking = { ...this.isChecking, [domainId]: true };
          setTimeout(() => {
            this.domains = this.domains.map(d =>
              d.id === domainId
                ? { ...d, spf: Math.random()>0.5, dkim: Math.random()>0.5, verified: d.spf && d.dkim }
                : d
            );
            this.isChecking = { ...this.isChecking, [domainId]: false };
            this.showNotification('DNS records checked!');
            this.$nextTick(() => lucide.createIcons());
          }, 2000);
        },
        deleteDomain(id) {
          this.domains = this.domains.filter(d => d.id !== id);
          this.showNotification('Domain deleted successfully');
        },
        deleteEmail(id) {
          this.senderEmails = this.senderEmails.filter(e => e.id !== id);
          this.showNotification('Sender email removed');
        },
        resendConfirmation(email) {
          this.showNotification(`Confirmation email sent to ${email.email}`);
        }
      }
    }
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Преобразуем все <i data-lucide="..."> в SVG
      lucide.createIcons();
    });
  
    // Если у вас динамический контент (Alpine обновляет DOM),
    // повторно вызывайте createIcons после изменений:
    document.addEventListener('alpine:updated', () => {
      lucide.createIcons();
    });
  </script>
</body>
</html>
